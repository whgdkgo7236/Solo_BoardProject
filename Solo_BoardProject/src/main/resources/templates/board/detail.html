<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
</head>
<body>
    <h2>detail.html</h2>
    <table>
        <tr>
            <th>글번호</th>
            <th>글제목</th>
            <th>글작성자</th>
            <th>글내용</th>
            <th>글조회수</th>
            <th>글첨부파일</th>
            <th>삭제</th>
            <th>수정하기</th>
        </tr>
        <tr>
            <td th:text="${boardList.id}"></td>
            <td th:text="${boardList.boardTitle}"></td>
            <td th:text="${boardList.boardWriter}"></td>
            <td th:text="${boardList.boardContents}"></td>
            <td th:text="${boardList.boardHits}"></td>
            <td th:multiple="${boardList.filePath}"></td>
            <td><button th:onclick="deletebtn([[${boardList.id}]])">삭제</button></td>
            <td><button th:onclick="updatebtn([[${boardList.id}]])" id="updatebtn">업데이트</button> </td>
        </tr>
    </table>
    <div th:id="comment-write">
        <input type="text" id="commentWriter" >
        <input type="text" id="commentContents">
        <button id="comments-write-btn">댓글등록</button>
    </div>
    <div id="comment-area">
        <table>
            <tr>
                <th>댓글번호</th>
                <th>작성자</th>
                <th>내용</th>
                <th>작성시간</th>
            </tr>

        </table>
    </div>

</body>

<script>
    $("#comments-write-btn").click(function(){
        const commentWriter = $("#commentWriter").val();
        const commentContents = $("#commentContents").val();
        const boardId = "[[${boardList.id}]]";
        $.ajax({
            type: "post",
            url:"/comment/save",
            data: {
                "commentWriter" : commentWriter,
                "commentContents" : commentContents,
                "boardId" : boardId
            },
            dataType : "json",
            success: function (result){
                console.log(result);
            },
            error: function (){
                alert("ajax 실패");
            }

        });
    });
    const updateBtn = document.getElementById("updatebtn");
    const sessionEmail="[[${sessionEmail}]]";

    const boardEmail = "[[${boardList.boardWriter}]]";

    if(sessionEmail==boardEmail){
        updateBtn.style.visibility="visible";
    }else{
        updateBtn.style.visibility="hidden";
    }
    function updatebtn(id){
        location.href="/board/update";
    }

    function deletebtn(boardid){
        const reqUrl = "/board/"+boardid;

        $.ajax({
            type: 'delete',
            url: reqUrl ,

            success: function (){
                console.log("성공");
                location.href="/board/";
            },
            error: function (){
                alert("ajax실패");
            }
        });
    }
</script>

</html>